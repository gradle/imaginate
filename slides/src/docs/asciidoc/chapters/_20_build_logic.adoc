[background-color="#02303a"]
== Gradle & Kotlin &#x2764;
image::gradle/bg-7.png[background, size=cover]

Build logic


=== Build logic [.small]#- Kotlin!#
image::gradle/bg-7.png[background, size=cover]

[cols="<.^6,<.^4",frame=none,grid=none]
|===
a|
Gradle's Kotlin DSL
[.small]
--
* Kotlin DSL on top of Gradle's Java API
* Low ceremony thanks to Kotlin Scripting
* Official Kotlin compiler plugins
* IDE assistance, code navigation etc...
--
a| include::fragments/_diagram_build-logic-parts.adoc[]
|===


=== Build logic [.small]#- Overview#
image::gradle/bg-7.png[background, size=cover]

[cols="<.^3,<.^7",frame=none,grid=none]
|===
a|
.`settings.gradle.kts`
[source,kotlin]
----
includeBuild("image-generation")
includeBuild("slides")

include("shared-resources")
include("shared-logic")
include("desktop-app")
include("android-app")
include("web-app")

for (project in rootProject.children) {
    project.projectDir = file("applications/${project.name}")
}
----

.`buildSrc/settings.gradle.kts`
[source,kotlin]
----
includeBuild("../image-generation")
----
a|
image::imaginate_tree.png[]
|===


=== Build logic [.small]#- Overview#
image::gradle/bg-7.png[background, size=cover]

[cols="<.^4,<.^6",frame=none,grid=none]
|===
a| include::fragments/_diagram_imaginate_overview_build_logic.adoc[]
a| include::fragments/_diagram_build-logic-graph.adoc[]
|===


=== Build logic [.small]#- `buildSrc`#
image::gradle/bg-7.png[background, size=cover]

[cols="<.^4,<.^6",frame=none,grid=none]
|===
a|
image::imaginate_buildSrc_tree.png[]
a|
Convention plugins

Composition over inheritance

.`applications/android-app/build.gradle.kts`
[source,kotlin]
----
plugins {
    id("android-app")
}

android {
    namespace = "imaginate.android"
}

dependencies {
    implementation(projects.sharedLogic)
}
----
[.small]
No imperative code in the projects build scripts, +
only declarative dsl.
|===


=== Build logic [.small]#- Exploration#
image::gradle/bg-7.png[background, size=cover]

image::gradle/folks.png[width=50%]

[.notes]
****
* start from the image generation
* used in the build logic
* buildSrc
* task + isolation
* convention plugin
* `kotlin-dsl` plugin, sam-with-receiver, assignment operator overload
* shared resources
* applications
* dependencies + version catalogs
****


=== Build logic [.small]#- `buildSrc`?#
image::gradle/bg-7.png[background, size=cover]

`buildSrc` vs `includeBuild` for build logic

The main difference is that everything in `buildSrc` is made available in the owner build's root project, thus all its projects.
With included builds you need to declare dependencies in order to use them.
A `plugins {}` request for a plugin from an included build brings the jar build by the projects that contain the plugin.
Regular `group:name(:version)` dependencies can also be used from `buildSrc`, or from `buildscript {}` blocks if necessary.

Start with `buildSrc` and move to included builds if you need.
For example as we showed Today for sharing logic between the build and the applications.
Or if you want to isolate a portion of build logic.

Since Gradle 8 `buildSrc` is much more like using included builds + link, making it simple to transition


=== Build logic [.small]#- Kotlin DSL#
image::gradle/bg-7.png[background, size=cover]

[cols="<.^6,<.^4",frame=none,grid=none]
|===
a|
[.small]
--
Gradle plugins contribute to a dynamic model

Kotlin DSL provides static accessors

* extensions and tasks
* projects and version catalogs

IDE assistance, code navigation etc...
--
a|
.Extensions and tasks
[source,kotlin]
----
plugins {
    id("org.jetbrains.kotlin.jvm")
}

kotlin {
    // Extension from the Kotlin plugin
}

tasks.compileKotlin {
    // Task from the Kotlin plugin
}
----

.Projects and version catalogs
[source,kotlin]
----
dependencies {

    // Static project accessor
    api(projects.sharedLogic)

    // Static version catalog accessor
    implementation(libs.wonderfulLibrary)
}
----
|===


=== Build logic [.small]#- Building blocks#
image::gradle/bg-7.png[background, size=cover]

* plugins!
* custom DSL
* custom Tasks
* build service
* helpers


=== Build logic [.small]#- Dependency management#
image::gradle/bg-7.png[background, size=cover]

* version catalogs
* dependencies on projects
* dependencies across included builds


=== Build logic [.small]#- Learn more#
image::gradle/bg-7.png[background, size=cover]

* Gradle's Kotlin DSL
** Documentation
** Reference
* Build organization
** Documentation
** Jendrik's videos
